# –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ –ø–æ Ansible

–°—Ç—É–¥–µ–Ω—Ç: **–ì–µ—Ä–∞—Å–∏–Ω –î–º–∏—Ç—Ä–∏–π –°–µ—Ä–≥–µ–µ–≤–∏—á**  
–ö—É—Ä—Å: Netology, CI/CD  
–î–∞—Ç–∞: 15.02.2026

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
homework-ansible/
‚îú‚îÄ‚îÄ ansible.cfg                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible
‚îú‚îÄ‚îÄ inventory/
‚îÇ   ‚îî‚îÄ‚îÄ lecture.ini            # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Ö–æ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ playbooks/                 # –ü–ª–µ–π–±—É–∫–∏ –∑–∞–¥–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ 01_kafka.yml
‚îÇ   ‚îú‚îÄ‚îÄ 02_tuned.yml
‚îÇ   ‚îú‚îÄ‚îÄ 03_motd.yml
‚îÇ   ‚îú‚îÄ‚îÄ deploy-apache.yml      # –° —Ä–æ–ª—å—é
‚îÇ   ‚îî‚îÄ‚îÄ deploy-apache-simple.yml
‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îî‚îÄ‚îÄ apache_webserver/      # –†–æ–ª—å –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è Apache
‚îÇ       ‚îú‚îÄ‚îÄ tasks/main.yml
‚îÇ       ‚îú‚îÄ‚îÄ handlers/main.yml
‚îÇ       ‚îú‚îÄ‚îÄ templates/index.html.j2
‚îÇ       ‚îî‚îÄ‚îÄ meta/main.yml
‚îú‚îÄ‚îÄ Vagrantfile                # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –í–ú –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ run-cluster.sh             # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ + –ø–ª–µ–π–±—É–∫–∞
‚îî‚îÄ‚îÄ README.md                  # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üß™ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Vagrant + Libvirt/KVM
- Ansible ‚â• 2.10
- –û–° —Ö–æ—Å—Ç–∞: Linux (–ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞ Linux Mint/Ubuntu)

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –í–ú –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–ª–µ–π–±—É–∫
./run-cluster.sh

# 2. –ò–ª–∏ –ø–æ —à–∞–≥–∞–º:
vagrant up
ansible-playbook -i inventory/lecture.ini playbooks/deploy-apache.yml
```

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 1: –¢—Ä–∏ –ø–ª–µ–π–±—É–∫–∞

### 01_kafka.yml
–°–∫–∞—á–∏–≤–∞–µ—Ç –∞—Ä—Ö–∏–≤ Kafka —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∑–µ—Ä–∫–∞–ª–∞, —Å–æ–∑–¥–∞—ë—Ç `/opt/kafka`, —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (`creates`).

![kafka](img/HW-ansible1.png)

### 02_tuned.yml
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–∞–∫–µ—Ç `tuned`, –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–µ–º–æ–Ω –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `systemd`.

![tuned](img/HWansible-2.png)

### 03_motd.yml
–ú–µ–Ω—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `motd_message`:

```yaml
vars:
  motd_message: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏! üöÄ\n–°–µ–≥–æ–¥–Ω—è {{ ansible_date_time.date }}\n"
```

![motd](img/HWansamble-3.png)

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 2: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–µ–π–±—É–∫ –≤—ã–≤–æ–¥–∏—Ç —Ö–æ—Å—Ç–Ω–µ–π–º, IP-–∞–¥—Ä–µ—Å –∏ –ø–æ–∂–µ–ª–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —á–µ—Ä–µ–∑ —Ñ–∞–∫—Ç—ã Ansible:

```jinja2
–•–æ—Å—Ç: {{ ansible_hostname }}
IP:   {{ ansible_default_ipv4.address }}
```

![motd2](img/HWansible-4.png)

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 3: –†–æ–ª—å –¥–ª—è Apache

–°–æ–∑–¥–∞–Ω–∞ —Ä–æ–ª—å `apache_webserver` —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```
roles/apache_webserver/
‚îú‚îÄ‚îÄ tasks/main.yml
‚îú‚îÄ‚îÄ handlers/main.yml
‚îú‚îÄ‚îÄ templates/index.html.j2
‚îî‚îÄ‚îÄ meta/main.yml
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `apache2` —á–µ—Ä–µ–∑ `apt`
- –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞ 80 —á–µ—Ä–µ–∑ `ufw`
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `index.html` —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω Jinja2 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∞–∫—Ç–æ–≤:
  - CPU: `{{ ansible_processor_vcpus }}`
  - RAM: `{{ (ansible_memtotal_mb / 1024) | round(1) }} –ì–ë`
  - –î–∏—Å–∫: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ—Ä–Ω–µ–≤–æ–º—É —Ä–∞–∑–¥–µ–ª—É
  - IP: `{{ ansible_default_ipv4.address }}`
- Handler `restart apache2` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `uri` (—Å—Ç–∞—Ç—É—Å 200)

![—Ä–µ–∑—É–ª—å—Ç–∞—Ç](img/HW-ansible5.png)
![—Å—Ç—Ä–∞–Ω–∏—Ü–∞](img/HW-ansible6.png)
![–ø—Ä–æ–≤–µ—Ä–∫–∞](img/HW-ansidlt-7.png)

---

## üì¶ –ê—Ä—Ö–∏–≤ —Ä–æ–ª–∏

–†–æ–ª—å —É–ø–∞–∫–æ–≤–∞–Ω–∞ –≤ –∞—Ä—Ö–∏–≤:
```bash
tar -czf apache_webserver.tar.gz roles/apache_webserver/
```

–§–∞–π–ª: [`apache_webserver.tar.gz`](https://drive.google.com/file/d/1Pre1cwkhsmxVi4DkY5YZQENE2LHg887a/view?usp=drive_link)

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–¥—É–ª–∏ `shell` –∏ `command` ‚Äî —Å–æ–±–ª—é–¥—ë–Ω –ø—Ä–∏–Ω—Ü–∏–ø –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.
- –í—Å–µ –ø–ª–µ–π–±—É–∫–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å –¥–≤–∞–∂–¥—ã ‚Äî –≤–æ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ `changed=0`.
- –î–ª—è `/etc/motd` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/etc/motd.d/99-custom` –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.